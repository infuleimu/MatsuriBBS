<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
    <mapper namespace="com.cn.matsuribbs.mapper.PostMapper">
        <select id="selectAll" parameterType="String" resultType="post">
            select * from post
        </select>

        <sql id="post_where">
            <if test="id != null and id !='' ">
                and id = "${id}"
            </if>
        </sql>

        <select id="selectCountByPageFun" parameterType="PageBean" resultType="int">
            SELECT count(*) FROM post
            <where>
                <include refid="post_where"></include>
            </where>
        </select>

        <resultMap id="postBean" type="post">
            <id column="id" property="id" />
            <result column="title" property="title" />
            <result column="content" property="content" />
            <result column="postDate" property="postDate" />
            <result column="type" property="type" />
            <result column="replyNum" property="replyNum" />
            <result column="viewNum" property="viewNum" />
            <association property="author" javaType="User">
                <result column="userName" property="userName" />
            </association>
        </resultMap>
        <select id="selectByPageFun" parameterType="PageBean" resultMap="postBean">
            SELECT p.*,u.userName,u.regDate FROM post p LEFT JOIN user u ON p.uid = u.id LEFT JOIN reply r ON p.id = r.pid LEFT JOIN sub_reply sr ON r.id = sr.rid GROUP BY p.id,u.id,r.id,sr.id
            <if test="id != null and id !='' ">
                HAVING p.sid = "${id}"
            </if>
            order by IFNULL(sr.replyDate,IFNULL(r.replyDate,p.postDate)) desc limit ${offset},${limit}
        </select>

        <!--<insert id="insertFun" parameterType="tblCustomer">
			insert into tbl_customer(customerName,password,customerTrueName,customerAddress,sex,customerEmail,customerPhone,customerRegDate)
			values(#{customerName},#{password},#{customerTrueName},#{customerAddress},#{sex},#{customerEmail},#{customerPhone},#{customerRegDate})
		</insert>

		<delete id="deleteFun" parameterType="int">
			delete from tbl_customer where customerId=#{id}
		</delete>-->

    </mapper>